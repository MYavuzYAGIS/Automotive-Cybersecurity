<!DOCTYPE html>
<html>
<head>
<title>Protocols & Cyber.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="h1important-protocolsh1"><h1>Important Protocols</h1></h1>
<h2 id="u-ipsec-u"><u> <strong>IpSec</strong> </u></h2>
<h3 id="what-is-ipsec"><strong>What is IpSec?</strong></h3>
<p>RFC 6071(IP Security (IPsec) and Internet Key Exchange (IKE) Document Roadmap)</p>
<p>IPsec is a protocol that provides a secure tunnel between two computers. It is used to protect data that is transmitted over the internet.</p>
<p>IPsec helps mitigation against:</p>
<ul>
<li>
<p>eavesdropping</p>
</li>
<li>
<p>theft</p>
</li>
<li>
<p>replay attacks,</p>
</li>
<li>
<p>Data corruption.</p>
</li>
</ul>
<p>Ipsec operates in 2 different modes: tunnel mode and transport mode.</p>
<p>In <em><strong>tunnel mode</strong></em>, everything is encapsulated in IPsec datagram. when data is transmitted, the layer 3 devices only use IPsec header to route the packet.</p>
<p>This is used basically in the site-to-site VPN and remote access VPN.</p>
<p>in <em><strong>transport mode</strong></em>, all of the data is protected but the original IP header is not. Payload is protected by IPsec. This is used generally in P2P applications.</p>
<h3 id="ipsec-building-blocks">Ipsec building Blocks:</h3>
<p>Ipsec Suite either uses <strong>Authentication Header(AH)</strong> or <strong>Encapsulating Security Payload (ESP)</strong>. One difference is that in the former, the data is encrypted.</p>
<p>ESP and AH both come with options of transport and tunnel.</p>
<p>In the AH transport mode, the payload is encrypted and the original IP header is not protected. In the tunnel mode, the payload is encrypted and the original IP header is protected. A new IP header is appointed to the packet in tunnel mode.</p>
<p>ESP transport and Tunnel modes can be used as it is or with AH.</p>
<p>ESP enapsulates the data so we have both header and trailer in the packet in Transport mode and in Tunnel mode.</p>
<p>in ESP header, different than AH header, there is no next header field and payload length field.</p>
<p>Afther the headers, there is <code>Security Association (SA)</code>.</p>
<p>Security Association in IPsec suite is a <code>unidirectional connection</code> that gives devices the capability to use AH or ESP services. for a bidirectional comms, a pair of SA is needed.</p>
<p><u>In order SA to be established, the following steps are needed:</u></p>
<ul>
<li>
<p><strong>SPI</strong>: Security Parameter Index. It is a unique number that is used to identify the SA.</p>
</li>
<li>
<p><strong>Security Protocol Identifier</strong>: It is a number that identifies the protocol that is used in the SA. (50 for AH or 51 for ESP)</p>
</li>
<li>
<p><strong>Destination IP Address</strong></p>
</li>
</ul>
<p>For key management, it is either done manually or automated using IKEv1 or IKEv2.</p>
<p><em><strong>IKE</strong></em> (Internet Key Exchange) is a protocol that is used to establish a key management between two computers. default one is IKEv2.</p>
<p>Next building block is <strong>Crypto Algorithm</strong>. These are used for Encryption , Authentication , Integrity and Pseudorandom Number Generation.</p>
<p>====</p>
<p>for SA estabblishement, there are couple of different protocols that are used.</p>
<ul>
<li>
<p><u>ISAKMP</u> (Internet Security Association Key Management Protocol) :  Used for procedures and formats to establish SA. It helps us build the SA.</p>
</li>
<li>
<p><u>OAKLEY</u> (One-Way Authentication Key Exchange Protocol) : gives key-exchange mechanissm. Used to exchange key over insecure connection using Diffie-Hellman.</p>
</li>
<li>
<p><u>SKEME</u> (Security Key Exchange Method) :gives anonimity and reputability through key-exchange techniques.</p>
</li>
<li>
<p><u>IKE</u> (Internet Key Exchange) : Uses combination of ISAKMP, OAKLEY, and SKEME</p>
</li>
</ul>
<p>=========</p>
<h3 id="ipsec-in-enterprise"><strong>Ipsec in Enterprise</strong></h3>
<p>In enterprise level, there are 2 main uses of IPsec:</p>
<ul>
<li><u>Site-to-Site VPN</u></li>
</ul>
<p>connect 2 or more sites together. One type of Site-to-Site VPN is <code>DMVPN</code> (Dynamic Multicast VPN).</p>
<p><code>logically</code> connects sites, protects <code>entire</code> network, provides corporate resources to other sites.</p>
<ul>
<li><u>Remote Access VPN</u></li>
</ul>
<p><code>logically</code> connect endpoint to another network.  IPsec using the OS IP stack. protects <code>individual</code> devices.</p>
<p>useful in wifi hotspots.</p>
<p>Bu mesela bir isci evden calisirken isyerinin agina ulassin diye kullanilan vpn. ticari bireysel VPNler de bu tip, hotspotshield, NordVPN gibi.</p>
<p>as for IPsec implementations, there are 2 main types:</p>
<ul>
<li><u>GRE over IPSec</u></li>
</ul>
<p>way more commen.</p>
<p>encapsulates entire packet.  this is essentially DMVPN over IPSec.</p>
<ul>
<li><u>IPSec over GRE  </u></li>
</ul>
<p>much less common. only the payload is protected via IPsec. routing information stays visible in the GRE portion of the datagram.</p>
<h3 id="uikev2u"><u><strong>IKEv2</strong></u></h3>
<p><u><strong>What is IKE</strong>?</u></p>
<p>IKE is Intrnet Key Exchange that uses ISAKMP, OAKLEY, and SKEME for establishing SA for securing network traffic.</p>
<p>Although IKEv1 is still used, IKEv2 is the new standard and IKEv1 is obsolete.</p>
<p>V2 brought these:</p>
<ul>
<li>
<p>new authentication method EAP (Extensible Authentication Protocol) alongside PKS and PKI</p>
</li>
<li>
<p>brought MOBIKE (Multicast Opportunistic Key Exchange) which allows dynamically change IP adresses without needing to re-establish the SA.</p>
</li>
<li>
<p>in V1, SA lifetime was negotiated, in V2, SA lifetime is configured locally and faster negotiation.</p>
</li>
<li>
<p>Flexible traffic selection per SA.</p>
</li>
</ul>
<p>Some benefits of IKEv2 are:</p>
<ul>
<li><strong><u>It is more reliable:</u></strong></li>
</ul>
<p>message flow system uses requests followed by responses. Initiator sends a request, and the responder sends a response. If the initiator does not receive a response, it will retry or drops the request. the reliability is on the initiator side.</p>
<ul>
<li><strong><u>It is more Mobile:</u></strong></li>
</ul>
<p>using MOBIKE, keeps VPN conenction active when changing IP addresses. thanks to <code>multihoming</code>, when interface drops, the traffic is moved to another interface.</p>
<ul>
<li><strong><u>it enables <code>High Availability</code>:</u></strong></li>
</ul>
<p>IKEv2 comes with <code>redirection</code> feature. if one server for VPN is taken down or went down, the users can be redirected to another server.</p>
<p>For authentication, IKEv2 uses<code> Pre-Shared Key</code> (PSK) and <code>Certificate Authentication</code>. Apart from that uses EAP.</p>
<p><em><strong>===========</strong></em>============<em><strong>==============</strong></em>==============<em><strong>==============</strong></em></p>
<h2 id="umacsecu"><u><strong>MacSec</strong></u></h2>
<p>Macsec is defined in 802.1AE as <code>point2point security protocol</code> providing <code>data confidentialiity, integrity, and origin authenticity</code> (all CIA triad.) for traffic over LAyer 1 or Layer 2 links and is part of larger security ecosystem.</p>
<p>Technically, on the transmit side of the link,MAcsec adds <code>Mac Security Tag</code> (SecTag, 8 to 16 bytes) and <code>Integrity Check Value</code> (ICV, 8 to 16 bytes) to the packet and can optionally encrypt the packet. on the receive side of the link the MacSec engine can identify and decrypt the packet, check integrity, provide <code>replay protection</code> and remoce SecTag and ICV. Invalid frames are discarded or monitored.</p>
<p>There is a need to protec data that is transmitted over the in-vehicle ethernet that is connecting <code>ECU</code>s together.</p>
<p>Data security protocols like MacSec are often deployed in Ethernet  Local Area Networks(LAN) that support <code>mission critical applications</code>.</p>
<p><strong>Macsec prt the <code>IEEE 802.1AE</code> standard PREVENTS LAYER 2 SECURITY THREATS SUCH AS PASSIVE WIRETAPPING, INTRUSION, MITM, AND REPLAY ATTACKS BY OFFERING LINE-RATE ENCRYPTION AND PROTECTION OF TRAFFIC LASSING OVER LAYER 1 AND/OR LAYER 2 LINKS.</strong></p>
<p>Although it is desirable, it is <strong>not practical to secure the entire network against physical access</strong> by determined attackers. <strong>Macsec allows only authorized systems that attach to and interconnect LANs in a network</strong> to maintain confidentiality and integrity of data and take measures against data theft.</p>
<ul>
<li><strong><u>Where does Macsec fit within OSI-layer model?</u></strong></li>
</ul>
<p>On the layer 1, there is Automotive Ethernet Physical Layer (AEPL) which is the layer that connects the physical layer of the vehicle to the network. these are like 100baseT, 1000baseT etc.</p>
<p>On the next layer, which is Layer 2, there is IEEE Ethernet MAc + VLAN(802.1Q) + AVB(802.1Qav) + TSN + <code>MacSec</code>. Hence, macsec is a layer 2 protocol that is sitting on top of the bare metal.</p>
<p>On the layer 3, there is IPv4 and IPv6 which are protected by <code>IpSec</code>. Hence IpSec is a layer 3 protocol.</p>
<ul>
<li><strong><u>What are some common Security Threats?</u></strong></li>
</ul>
<p>These are some of the common threats against Ethernet Lan:</p>
<ul>
<li>
<ul>
<li>Eavesdropping (compromising routers, links, DNS, or algorithms)</li>
</ul>
</li>
<li>
<ul>
<li>Sending arbitrary data including IP headers.</li>
</ul>
</li>
<li>
<ul>
<li>Replay attacks.</li>
</ul>
</li>
<li>
<ul>
<li>Tampering message in transit.</li>
</ul>
</li>
<li>
<ul>
<li>writing malicious code and deceiving people into running it.</li>
</ul>
</li>
<li>
<ul>
<li>exploiting bugs in software to take over machines ans use them as base for future attacks.</li>
</ul>
</li>
</ul>
<p>While IPsec is encryption at Layer 3, MacSec is encryption at Layer 2 which is Ethernet layer.</p>
<p>Remember this : ==&gt; <code>IEEE 802.1AE</code></p>
<p>Compared to IPsec:</p>
<ul>
<li>
<p>MacSec provides STRONGER ENCRYPTION performance at HIGHER SPEEDS.</p>
</li>
<li>
<p>Macsec can encrypt user data at UP TO 800Gig Ethernet Speeds without any hardware offloading.</p>
</li>
<li>
<p>Very little latency.</p>
</li>
<li>
<p>Application to any network that relies on Ethernet so can be used in many places =&gt; so Data Center, Corporate environment, Service Provider, etc.</p>
</li>
<li>
<p>Allows to protect all protocols virtually, including layer 2 protocols like AVB TP (IEEE 1722)</p>
</li>
<li>
<p>The smallest attack surface on Ethernet-based links for attacks with physical access to a medium</p>
</li>
</ul>
<p>IPSEC and TLS are software based but MacSec is hardware(phy and switches) based. so it makes it more robust and secure!</p>
<h3 id="packet-structure">Packet Structure:</h3>
<p>A captured MacSec packet has some options and payloads.</p>
<p>-&gt; <u><strong>802.1AE Security Tag.</strong></u></p>
<p>This Tag has some option flags like VER, ES, E.</p>
<p>E flag is set to 1 if the packet is <code>encrypted</code>.</p>
<p>-&gt; <u><strong>ICV Value</strong></u></p>
<p>ICV is a checksum that is used to verify the integrity of the packet.</p>
<p>-&gt; <u><strong>Port Identifier.</strong></u></p>
<p>shows on what port the packet was captured on.</p>
<p>-&gt; <u><strong>Data</strong></u></p>
<p>Data is the encrypted payload. looks like a random hash value.</p>
<h3 id="u-macsec-terminologyu"><u> MacSec Terminology</u>:</h3>
<ol>
<li><u><strong>MacSec Key Agreement Protocol</strong></u></li>
</ol>
<p>Used to discover Macsec capable peers and used to negotiate encryption keys. These keys are for <code>data encryption</code> and <code>Security Associataion Key Encryption</code>(SAK)</p>
<ol start="2">
<li><u><strong>Connectivity Association (CA)</strong></u></li>
</ol>
<p>Similar to <code>IPSec SA</code> but for MacSec. Defines a secure relationship between MacSec peers.</p>
<p>After authentication and key exchange are performed, a secure communication link,  called <code>Secure Channel</code> is established using Macsec from one node inside CA to another.  in MAcSec protected network, each node has at least one <code>unidirectional secure channel</code>. The Secure channel does not expire and lasts for the duration of  the communication between two nodes. Each secure channel is associated with an <code>identifier</code> : the <code>Secure Channel Identifier</code> SCI.</p>
<p>Within each secure channel(both transmit and receive), Secure Associations are defined. each Secure association has a corresponding <code>Secure Association Key</code> (SAK) and is identified by the Association Number field of the SecTag header. Secure Associations have limited duratuion. this is called Key Rotation.</p>
<ol start="3">
<li><u>**Connectivity Association Key(CAK) **</u></li>
</ol>
<p>Static or Dynamic Key exchanged by macsec speakers. This can be seen as <code>primary key</code> that is used to device all other session keys.</p>
<p>So CAK is used to derive SAK keys and this SAK keys are used to encrypt the user data.</p>
<p>So this CAK can be statically confiugred or can be distributed by the server.</p>
<ol start="4">
<li><u>**Connectivity Association Key Name (CKN) **</u></li>
</ol>
<p>Any name that defines a CAK.</p>
<ol start="5">
<li><u>**Primary and Fallback Keys **</u></li>
</ol>
<p>Primary key is used to negotiate an MKA if this fails, Fallback key is used.</p>
<ol start="6">
<li><u>** Security Association Keys(SAK)**</u></li>
</ol>
<p>Derived from CAK used to encrypt data as mentioned earlier.</p>
<p><strong>Within each Secure Association, <code>replay protection</code> can be performetd by checking the Packet Number field of SecTAG header agaisnt the packer number locally stored since ehac macsec packet has a uniqe sequential packet and each packet number can be used only once.</strong></p>
<p>A <code>Key Server</code> generates SAK.  If you have if you have one switch connected to another switch on ethernet link and MacSec is enabled on this switch, one of these switches will be a Key Server. You can either configure one of these switches as higher priority to make it key server</p>
<p>if you enable MacSec on an interface, it drops all frames except MAcsec encrypted frames. But you can configure macsec profile to allow unprotected traffic in macsec negotiation fails.</p>
<p><em><strong>===========</strong></em>============<em><strong>==============</strong></em>==============<em><strong>==============</strong></em></p>
<h3 id="uwhat-is-ieee-8021xu"><u><strong>What is IEEE 802.1X</strong></u></h3>
<p>IEEE 802.1X is a network authentication protocol that opens ports for network access when a user's identity is authenticated it also authorizes them for acess to the network.</p>
<p>IEEE 802.1X is an Port-Based Network Access Control(PNAC) standard that provides protected authentication for secure network access.</p>
<p>an 802.1X network is <code>different from home networks in one MAJOR way</code>: it  has an authntication server called <code>RADIUS Server</code> which checks user's credentials to see if they are an active member of the organization and , depending on the netwrk policies, ggrants them various access rights. This helps unique credential creation for each user, eliminating the reliance on single network password that can be easily cracked or stolen.</p>
<p>the RADIUS server is able to do it in various ways, typically over LDAP or SAML protocol.</p>
<h3 id="uwhat-are-possible-macsec-use-cases-within-ethernet-networku"><u><strong>What are possible MACsec use cases within Ethernet Network</strong></u></h3>
<p>If a hacker taps into the macsec disabled network, the flowing data can be obtained by hacker and can be used to perform attacks. Hacker can target switches, can tap into the network, or can monitor the device.</p>
<p>if macsec is enabled, tapping or eavesdropping, or replay attacks are not possible since packets are numbered, encrypted. <strong>HOWEVER</strong> hacker CAN disrupt the network using DOS attack if DOS prevention is disabled. in this case, neither hacker nor the vehicle can receive the packets. if DOS prevention is Enabled, the Video stream(i.e.) remains disturbed but DOS does not propogate through the Ethernet phy.</p>
<p>Macsec is cost-effective and could be used in combination with other technologies like IPsec, TLS, etc.</p>
<h2 id="uarpsecu"><u><strong>ArpSec</strong></u></h2>
<h2 id="usshu"><u><strong>SSH</strong></u></h2>
<p>secure shell.</p>
<p>Just like HTTP and HTTPS, the protocols SSH and TELNET are also operate in the OSI model's layer 5 which is <code>session</code> layer.</p>
<p>In the OSI model, <code>Appliacation, Presentation, Session and Transport</code> layers are called <code>Host</code> layers while the remaninng <code>Network, Data Link and Physical</code> layers are called <code>Media</code> layers.</p>
<p><u>Network Layer</u> ==&gt; routers, Ipv4, Ipv6, ICMP. address assingment, routing between network nodes and control of moving network traffic possible.</p>
<p><u>Data Layer</u> ==&gt; Once the network is connected in the layer 3, Data Link layer transmits the data. A data frame is a data that holds link layer header.</p>
<p>A data link layer frame has the following parts: Frame Header: It contains the source and the destination addresses of the frame and the control bytes. Payload field: It contains the message to be delivered. Trailer: It contains the error detection and error correction bits.</p>
<p>SSH works in one of 3 ways:</p>
<ul>
<li>
<p>RSA rhost authentication (rhost and shost, but a bit weakly secured)</p>
</li>
<li>
<p>Private-key authentication ( cari olan islem bu.)</p>
</li>
<li>
<p>Password authentication</p>
</li>
</ul>
<h1 id="h1cybersecurity-notesh1"><h1>CyberSecurity Notes</h1></h1>
<h2 id="uisosae-21434u"><u><strong>ISO/SAE 21434</strong></u></h2>
<p>==&gt; Automotive Cybersecurity standarts are defined by <code>ISO/SAE 21434</code></p>
<p>Helped creating common terminology accross the industry.</p>
<p>Helped creating minimum base criteria for cybersecurity in the vehicle.</p>
<p>Creating security assurance level.</p>
<p>It is a reference that regulators point to. In order to enforce a standard, now regulators have a reference point.</p>
<p>The scope of ISO 21424 :</p>
<ul>
<li>
<p>Risk Management (Assess, monitor, evaluate potential risks.)</p>
</li>
<li>
<p>Product Development (security of systems, hardware&amp;software,</p>
</li>
<li>
<p>performing TARA(Threat Analysis Risk Assessment) )</p>
</li>
<li>
<p>VARA (vulnerability analysis risk assessment)</p>
</li>
<li>
<p>Operation, maintenance, and processess. Starting from beginning to the end, covers all aspects.</p>
</li>
<li>
<p>process overview and interdepencencies.</p>
</li>
<li>
<p>An <code>Assurance Level</code> is defined with ISO 21424 which is <code>Cybersecurity Assurance Level</code> this is like common security assurance level like how secure is the system or how much trust you can put onto it.</p>
</li>
</ul>
<h2 id="ucanbus-idsips-vs-ethernet-ipsidsu"><u><strong>CanBus IDS/IPS vs Ethernet IPS/IDS</strong></u></h2>
<h3 id="ucomparing-can-and-ethernetu"><u><strong>Comparing Can and Ethernet</strong></u></h3>
<p>CanBus is a Bus topology which means when a message leaves and ECU, it is guaranteed to reach any neighbir ecu on the same bus. Meaning there is no way to stop an attack using software which reside in the gateway since it is just listening to the traffic. Gateway can only stop propogation of the message from one bus to another but not on the same bus.</p>
<p>On the other hand, the ethernet is a star topology meaning on each port there is exactly one device is connected any device that is sent by the device can be inspected by the gateway.</p>
<p>Since ethernet is MUCH more speedy comparing to the Can, any IDS or IPS system needs lots of horsepower to be able to undertake full or partial analysis.</p>
<p>Message length in Can bus is only 8 bytes (60 for Can FD) compared to Ethernet which is 1500 bytes.</p>
<p>In terms of <code>source identification</code>, there is no source ID in can bus there is only Message ID. So you cannot tell who sent the message. This can be done using encapsulated protocols like <code>j1939</code> but standard does not have message origin identification. Can bus does not have any specific <code>message destionation</code> as well, it only has <code>message id</code> which is a <code>multicast</code> address that anyone can listen to it.</p>
<p>In ethernet, on the other hand, there is <code>distinct unicast</code> that means it has source and destination mac addresses, all clear. and etherenet support both unicast and multicast hence, with ethernet it is much easier to detect the source of a message.</p>
<p>Beware that <code>automotive ethernet</code> is not necessarily about ethernet, it is about  all the networking. For example, on top of ethernet sits MAC, and then on top of that sits IP, on top of that sits TCP/IP or UDP/IP. To the application level, there is DoIP.</p>
<h3 id="ucan-and-autmotive-ethernet-idsips-work-processu"><u><strong>Can and Autmotive Ethernet IDS/IPS work process</strong></u></h3>
<p>IDS/IPS is designed to counter an attacker manipulating network traffic via a malicious application, hacked ECU or other controller.</p>
<p>It has 3 steps:</p>
<ul>
<li>
<p>It <code>learns</code> the normal.</p>
</li>
<li>
<p>it <code>monitors</code> the network traffic and the <code>Routing</code> function of gateway rules</p>
</li>
<li>
<p>it <code>Detects</code> anomalies based on deviation from <code>normal</code>. Prevents by discarding frames when possible.</p>
</li>
</ul>
<p><u><strong>Comparing CAn and Ethernet Rules Generation</strong></u></p>
<ul>
<li>
<p>both of the them require recordings to generate rules out of it.</p>
</li>
<li>
<p>Both of them use <code>files</code> where CAN uses DBC extension, ethernet uses XML.</p>
</li>
<li>
<p>Both of them allow user to edit rules manually.</p>
</li>
<li>
<p>Rule generation is simple in CAn Bus(but can get complicated if j1939 is used because dynamic adressing comes into play) and is complex in ethernet due to network nature (Mac adresses, DHCP, DoIO etc protocols)</p>
</li>
<li>
<p>CAN is static, predictive and deterministic and uses whitelisting. But ethernet is more volatile, it uses both black and white lists simultaneously, also <code>signature based</code> detection. Signature based detection is not implemented in Can Bus.</p>
</li>
</ul>
<p><u><strong>CAN and Ethernet IDS/IPS Architecture</strong></u></p>
<p>IDS systems are essentially sdk integrated into ecu. This ECU can be an existing ECU like gateway or a dedicated ECU attached to CAN bus.</p>
<p>Incoming message/frame is <code>routed</code> to IDS/IPS to be processed.</p>
<p>the IDS/IPS inspects the message/frame and returns its findings with the associated information.</p>
<p>In case of anomaly, an event is reported.</p>
<p>when configured as IPS, when possible, the anomalous packet is discarded.</p>
<p>Can message is determined to be passing or not based on message ID, if valid, it is passed else, it is discarded. There is a possibility that a compromised ECU can send a message with a valid ID and if it is not a periodic message, it is not possible to determine it was an attack.</p>
<p>Ethernet Packet is filtered based on filtering rules initially. if it is not in white and blacklist, the default rule applies.</p>
<p><strong>Canbus:</strong></p>
<p>In Canbus, these IDPS will most likely be integrated into gateway, in other cases, it can be connected directly into ecus.</p>
<p>If we use IDS not IPS, it just taps into network so there is no need for changes in the vehicle.</p>
<p><strong>Ethernet:</strong></p>
<p>it <code>definitely</code> goes into gateway. it serves as automotive backbone.</p>
<p><u><strong>Message Formality</strong></u></p>
<p><strong>Canbus:</strong></p>
<p>Relatively easy to validate the format since the message is very short. only exception is CanBus TP(transport protocol) and SAE j1939 TP is used which adds more complexity.</p>
<p><strong>Ethernet:</strong></p>
<p>Etherned side of the message is much harded, needs 7 layer <code>Deep Packet Inspection(DPI)</code> to determine individual message format validity. For example:</p>
<ul>
<li>
<p>Ethernet frame</p>
</li>
<li>
<p>IP header</p>
</li>
<li>
<p>UDP header</p>
</li>
<li>
<p>DoIP PDU header</p>
</li>
<li>
<p>UDS PDU header</p>
</li>
</ul>
<p><u><strong>Protocol Message Flow</strong></u></p>
<p><strong>Canbus:</strong></p>
<p>Relatively easy to validate flow, with requests and responses, and order of messages.</p>
<p>Impossible to determine ECU origin. Need to add digital signature using 3rd party compression softwares or SecOC.</p>
<p><strong>Ethernet:</strong></p>
<p>To capture a packet flow, you need to follow full OSI 7 layers individually and another problem is many fields are dynamically assigned per instance.</p>
<p><u><strong>Diagnostics</strong></u></p>
<p><strong>Canbus:</strong></p>
<ul>
<li>
<p>Using UDS protocol,</p>
</li>
<li>
<p>Many attack options like hacker engaging diagnostics while normal driving.</p>
</li>
<li>
<p>Detection and some prevention is possible but somewhat complex since it must be based on a combination of considerations such as vehicle context and usage of transport protocols.</p>
</li>
</ul>
<p><strong>Ethernet:</strong></p>
<ul>
<li>
<p>based on DoIP and layered UDS protocol.</p>
</li>
<li>
<p>Complex mechanism with multiple architectures and implementatitions(like DHCP)</p>
</li>
<li>
<p>Many attack options like hacker engaging diagnostics while normal driving.</p>
</li>
<li>
<p>sometimes detection is complex, especially if attacker is launched from compromised ECU from within the vehicle.</p>
</li>
</ul>
<p>When running diagnostics in the test workshop using multiple vehicles connected to each other and the test machine, in order to prevent vehicle attacking to another vehicle, the configuration should be set to <code>multiplexler</code> not <code>full-mesh</code> so central gateway can talk to each vehicle but vehicles can talk to each other.</p>
<p>On media diagnosticsin CAN, the MOST system will not be incpected due to it is <code>airgapped</code>and low cyber risk. Also Automotive-Ethernet AVTP(Audio-Video Transfer Protocol) , which is not airgapped and very intense in traffic, will probably not be inspected but can be tested by partial sampling for protocol integrity.</p>
<p><u><strong>Reporting</strong></u></p>
<p><strong>Canbus:</strong></p>
<p>CanBus telematics messages. CAN id will send messages to be conveyed to SOC and analyzed there</p>
<p>Other options are possible such as independent SMS over cellular.</p>
<p><strong>Ethernet:</strong></p>
<p>a) <strong><code>SOME/IP </code>messages to telematics, API sending messages to microcontroller.</strong></p>
<p><em><strong>What is SOME/IP?</strong></em></p>
<p>SOME/IP is a middleware where SOME stands for <code>Scalable service oriented middleware</code> which creates absraction in automotive and used for standardization of:</p>
<ul>
<li>header format,</li>
<li>payload serialization rules</li>
<li>service discovery mechanism</li>
<li>remote procedure call mechanism(RPC)</li>
</ul>
<p>data needs to be serialized. the faster the communication, the more resouce hungry the serialization. so there needs to be a fast and efficient middleware to serialize data. Due to string operations, text-based serialization and deserialization(JSON, XML these are self descriptive(structured) and text based) are very slow so a binay operation neededd. SOME/IP allows you to build the most efficient hi-speed performance system,formatting is optimized for low resources and high speed directly works on binary data.
SOME/IP is like XML and JSOn, which are very slow. SOME/IP works on binary data and non-descriptive. it is fastest due to <code>zero-copy</code> and nearly as fast as Raw struct which is not serialization.</p>
<p>Advantages of SOME/IP Protocol
SOME/IP protocol has many advantages compared to traditional automotive protocols like CAN, LIN, and MOST. Some of the worth-noting advantages of SOME/IP are the following:</p>
<ol>
<li>
<p>Some/IP is license Free.</p>
</li>
<li>
<p>SOME/IP designed automotive use cases in mind, scales very well.</p>
</li>
<li>
<p>SOME/IP provides large bandwidth for data communication in the range of 100Mbps and takes care of not wasting the bandwidth at all by providing all data communications in a client-server configuration.</p>
</li>
<li>
<p>SOME/IP is supported by <code>AUTOSAR</code>, very fast in serialization, has <code>built in service discovery</code></p>
</li>
<li>
<p>The data from the server ECU can be communicated to client ECU via unicast, multicast, and broadcast.</p>
</li>
<li>
<p>Being a middleware, it is suitable even for CPU-intensive applications, and OS-agnostic.</p>
</li>
</ol>
<p>b) <strong>Syslog format for direct interface to SIEM at the SOC.</strong></p>
<p>c) <strong>other proprietary formats over IP are possible.</strong></p>
<p><u><strong>Some TakeAways</strong></u></p>
<ul>
<li>
<p>threats and risks are much more severe in automotive ethernet than in CAN bus.</p>
</li>
<li>
<p>several areas are similar so some R&amp;D effort on CAN can be used for ethernet.</p>
</li>
<li>
<p>IDPS for ethernet is much more complex than for CAN.</p>
</li>
<li>
<p>designing IDPS for autmotife ethernet requires expertise both in automoive field and in IT networking.</p>
</li>
<li>
<p>For network security, SSL/TLS, VPN, IPSec protocols are for backend connectivity, MacSEc can protect all multicast, unicast, broadcast messages at line-speed. SecOC allows application layer protection for selected use cases.</p>
</li>
<li>
<p>for access control, Ethernet access Control and SOME/IP is used</p>
</li>
<li></li>
</ul>
<h2 id="usecocu"><u><strong>SecOC</strong></u></h2>
<p>SecOC = Secure OnBoard Communication.
https://www.youtube.com/watch?v=muz9yoSncqM
https://www.youtube.com/watch?v=LE6juLgilA4</p>
<h2 id="ukey-management-systemsu"><u><strong>key management systems</strong></u></h2>
<p>https://www.youtube.com/watch?v=Qa7-8mZYkkM</p>
<p>===</p>
<p>https://www.youtube.com/watch?v=CC3frh-Kjv4 ==&gt; very important
https://www.youtube.com/watch?v=D52CsJqE_R4</p>
<p>TAKE SOME IMPORTANT PARTS
https://app.pluralsight.com/library/courses/ethernet-operation-switch-configuration/table-of-contents
https://app.pluralsight.com/library/courses/comptia-network-plus-networking-concepts/table-of-contents
https://app.pluralsight.com/library/courses/using-unit-testing-python/table-of-contents</p>
<p><code>All People Seem To Need Data Processing</code>  ===&gt; OSI model ezber</p>
<p>A — Application — All
P — Presentation — People
S — Session — Seem
T — Transport — To
N — Network — Need
D — Data Link Layer — Data
P — Physical — Processing</p>

</body>
</html>
